<div class="dashboard-container">
  <h1>Smiles Dental Clinic - Dashboard</h1>

  <div class="stats-grid">
    <div class="stat-card patients">
      <div class="stat-icon">ðŸ‘¥</div>
      <div class="stat-info">
        <h3>Total Patients</h3>
        <p class="stat-value">{{ totalPatients }}</p>
      </div>
      <button class="btn-view" (click)="navigateTo('/patients')">View All</button>
    </div>

    <div class="stat-card appointments">
      <div class="stat-icon">ðŸ“…</div>
      <div class="stat-info">
        <h3>Today's Appointments</h3>
        <p class="stat-value">{{ todayAppointments.length }}</p>
      </div>
      <button class="btn-view" (click)="navigateTo('/appointments')">View All</button>
    </div>

    <div class="stat-card revenue">
      <div class="stat-icon">ðŸ’°</div>
      <div class="stat-info">
        <h3>Total Revenue</h3>
        <p class="stat-value">${{ totalRevenue | number:'1.2-2' }}</p>
      </div>
      <button class="btn-view" (click)="navigateTo('/billing')">View All</button>
    </div>
  </div>

  <div class="dashboard-grid">
    <div class="dashboard-card calendar-card">
      <div class="calendar-header">
        <h2>
          <span class="calendar-icon">ðŸ“…</span>
          Today's Appointments
        </h2>
      </div>
      
      <div class="calendar-widget">
        <div class="calendar-nav">
          <button class="calendar-nav-btn" (click)="previousMonth()">â€¹</button>
          <h3 class="calendar-month-year">{{ monthNames[currentMonth] }} {{ currentYear }}</h3>
          <button class="calendar-nav-btn" (click)="nextMonth()">â€º</button>
        </div>
        <button class="today-btn" (click)="goToToday()">Today</button>
        
        <div class="calendar-grid">
          <div class="calendar-day-header" *ngFor="let day of dayNames">
            {{ day }}
          </div>
          <div 
            class="calendar-day" 
            *ngFor="let day of calendarDays"
            [class.today]="isToday(day)"
            [class.has-appointment]="hasAppointment(day)"
            [class.empty]="day === null"
            (click)="onCalendarDateClick(day)"
            [style.cursor]="day ? 'pointer' : 'default'">
            <span class="day-number" *ngIf="day">{{ day.getDate() }}</span>
            <div class="appointment-count-badge" *ngIf="day && hasAppointment(day)">
              {{ getAppointmentCountForDate(day) }}
            </div>
          </div>
        </div>
      </div>

      <div class="today-appointments-section">
        <h3>Today's Schedule</h3>
        <div class="appointments-list" *ngIf="todayAppointments.length > 0; else noTodayAppointments">
          <div class="appointment-item" *ngFor="let appointment of todayAppointments">
            <div class="appointment-time">{{ appointment.appointmentTime }}</div>
            <div class="appointment-details">
              <strong>{{ getPatientName(appointment.patientId, appointment) }}</strong>
              <span>{{ appointment.type }}</span>
            </div>
          </div>
        </div>
        <ng-template #noTodayAppointments>
          <p class="empty-message">No appointments scheduled for today.</p>
        </ng-template>
      </div>
    </div>

    <div class="dashboard-card">
      <h2>Upcoming Appointments (Next 7 Days)</h2>
      <div class="appointments-list" *ngIf="upcomingAppointments.length > 0; else noUpcomingAppointments">
        <div class="appointment-item" *ngFor="let appointment of upcomingAppointments">
          <div class="appointment-date">{{ appointment.appointmentDate | date:'shortDate' }}</div>
          <div class="appointment-time">{{ appointment.appointmentTime }}</div>
          <div class="appointment-details">
            <strong>{{ getPatientName(appointment.patientId, appointment) }}</strong>
            <span>{{ appointment.type }}</span>
          </div>
        </div>
      </div>
      <ng-template #noUpcomingAppointments>
        <p class="empty-message">No upcoming appointments.</p>
      </ng-template>
    </div>
  </div>

  <div class="dashboard-card">
    <h2>Recent Patients</h2>
    <div class="patients-list" *ngIf="recentPatients.length > 0; else noRecentPatients">
      <div class="patient-item" *ngFor="let patient of recentPatients">
        <div class="patient-avatar">{{ patient.firstName.charAt(0) }}{{ patient.lastName.charAt(0) }}</div>
        <div class="patient-info">
          <strong>{{ patient.firstName }} {{ patient.lastName }}</strong>
          <span>{{ patient.phone }}</span>
        </div>
        <button class="btn-view-small" (click)="navigateTo('/patients')">View</button>
      </div>
    </div>
    <ng-template #noRecentPatients>
      <p class="empty-message">No patients yet.</p>
    </ng-template>
  </div>

  <!-- Appointment Modal -->
  <div class="modal" *ngIf="showAppointmentModal" (click)="closeAppointmentModal()" style="display: flex;">
    <div class="modal-content appointment-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Appointments for {{ getFormattedDate(selectedCalendarDate) }}</h2>
        <button class="close-btn" (click)="closeAppointmentModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div *ngIf="appointmentsForSelectedDate.length === 0" class="empty-appointments">
          <p>No appointments scheduled for this date.</p>
        </div>
        <div *ngIf="appointmentsForSelectedDate.length > 0" class="appointments-list-modal">
          <div class="appointment-item-modal" *ngFor="let appointment of appointmentsForSelectedDate">
            <div class="appointment-time-modal">{{ formatTime(appointment.appointmentTime) }}</div>
            <div class="appointment-details-modal">
              <div class="patient-name-modal">
                <strong>{{ getPatientName(appointment.patientId, appointment) }}</strong>
              </div>
              <div class="appointment-info-modal">
                <span class="appointment-type">{{ appointment.type }}</span>
                <span class="appointment-duration">{{ appointment.duration }} min</span>
              </div>
            </div>
            <div class="appointment-status-modal">
              <span 
                class="status-badge"
                [class.status-scheduled]="appointment.status === 'Scheduled'"
                [class.status-completed]="appointment.status === 'Completed'"
                [class.status-cancelled]="appointment.status === 'Cancelled'"
                [class.status-no-show]="appointment.status === 'No Show'">
                {{ appointment.status }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
